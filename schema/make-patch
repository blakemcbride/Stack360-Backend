#

SVN_BASE=

if [ $# -ne 3 ]; then
	echo "Usage:  ./make-patch  starting-rev  ending-rev  trunk/<branch-number>"
	exit 1
fi

if [[ ! $1 =~ ^[0-9]+$ ]]  ||  [[ ! $2 =~ ^[0-9]+$ ]]; then
	echo Arguments must be numeric.
	exit 1
fi

if [ $1 -ge $2 ]; then
	echo The second argument must be greater than the first.
	exit 1
fi

if [ $3 = "trunk" ]; then
	SVN_PATH=$SVN_BASE/trunk/schema/ArahantSchema.sql
else
	SVN_PATH=$SVN_BASE/branches/$3/schema/ArahantSchema.sql
fi

echo Exporting schema $1
svn export -r$1 $SVN_PATH schema-$1.sql
echo Exporting schema $2
svn export -r$2 $SVN_PATH schema-$2.sql

echo Generating PostgreSQL patch file.
echo >P_$2.sql
echo "-- PostgreSQL patch from revision $1 to revision $2" >>P_$2.sql
echo >>P_$2.sql
java -jar DBSync4.jar -ip schema-$1.sql -ip schema-$2.sql -op >>P_$2.sql

echo Generating Microsoft SQL Server patch file.
echo >M_$2.sql
echo "-- Microsoft SQL Server patch from revision $1 to revision $2" >>M_$2.sql
echo >>M_$2.sql
java -jar DBSync4.jar -ip schema-$1.sql -ip schema-$2.sql -om >>M_$2.sql

echo Process complete.

rm schema-$1.sql schema-$2.sql
